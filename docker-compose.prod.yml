version: "3.9"
services:
  # MYSQL Database (igual que en dev)
  database:
    image: mysql:8.0.35
    volumes:
      - db_data:/var/lib/mysql
    restart: unless-stopped
    command: --default-authentication-plugin=mysql_native_password
    environment:
      MYSQL_DATABASE: "${MYSQL_DATABASE}"
      MYSQL_USER: "${MYSQL_USER}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD}"
      MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
    networks:
      - wp_network

  # WORDPRESS (modificado para producción)
  wordpress:
    depends_on:
      - database
    image: custom-wordpress:latest # Imagen personalizada
    ports:
      - "80:80" # Puerto estándar HTTP
    restart: unless-stopped
    volumes:
      - wp_uploads:/var/www/html/wp-content/uploads # Uploads en volumen
      - ./wp-content/plugins:/var/www/html/wp-content/plugins # Plugins versionados
      - ./wp-content/themes:/var/www/html/wp-content/themes # Temas versionados
    environment:
      WORDPRESS_DB_HOST: database:3306
      WORDPRESS_DB_NAME: "${MYSQL_DATABASE}"
      WORDPRESS_DB_USER: "${MYSQL_USER}"
      WORDPRESS_DB_PASSWORD: "${MYSQL_PASSWORD}"
      WORDPRESS_DEBUG: "0" # Debug desactivado
      WORDPRESS_TABLE_PREFIX: "${WORDPRESS_TABLE_PREFIX}"
    networks:
      - wp_network

  # PHPMYADMIN (opcional en producción, solo si es necesario)
  phpmyadmin:
    depends_on:
      - database
    image: phpmyadmin:5.2.2
    restart: unless-stopped
    ports:
      - "8080:80" # Cambiado a un puerto no estándar
    environment:
      PMA_HOST: database
      MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
    networks:
      - wp_network

networks:
  wp_network:

volumes:
  db_data:
  wp_uploads: # Volumen para uploads en producción
